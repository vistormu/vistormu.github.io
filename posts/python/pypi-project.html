<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
	<title>Vistor's Blog: PyPi Project</title>
	<link rel="stylesheet" href="./../../style.css">
</head>
<body>

<link id="highlight-style" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.0/highlight.min.js"></script>
    
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <a href="./../../index.html">Vistor's Blog</a>
            </div>
            <nav>
                <a href="./../../about.html" class="nav-link">about</a>
            </nav>
        </div>
    </header>

    <div class="content-wrapper">
<div style="position: relative; height: 10px; width: 100%;">
        <div style="height: 10px;"></div>
        <div class="rectangle" style="background-color: var(--yellow); width: 220px; left: 49px;"></div>
        <div style="height: 12px;"></div>
        <div class="rectangle" style="background-color: var(--red); width: 266px; left: 72px;"></div>
    </div>
<h1 id="upload-a-python-package-to-pypi">
	Upload a Python Package to PyPi
</h1>
<div style="text-align: center;"><div class="subtitle">Published on <mark>jan 30th 2024</mark>. Last edit on <mark>jan 30th 2024</mark></div></div>
<p>
	If you're frequently programming in Python and have developed custom tools that are useful across multiple projects, it's a smart move to consider publishing them on PyPI. This blog post will show you how to do that. We'll also cover how to manage your release versions and keep a tidy changelog.
</p>
<div style="position: relative; height: 10px; width: 100%;">
        <div style="height: 10px;"></div>
        <div class="rectangle" style="background-color: var(--white); width: 270px; right: 67px;"></div>
        <div style="height: 11px;"></div>
        <div class="rectangle" style="background-color: var(--green); width: 208px; right: 48px;"></div>
    </div>
<h2 id="table-of-contents">
	Table of Contents
</h2>
<ul>
<li><a href="#project-structure">Project Structure</a></li>
<li><a href="#necessary-files">Necessary Files</a></li>
<li><a href="#build-the-project">Build the Project</a></li>
<li><a href="#upload-the-project">Upload the Project</a></li>
<li><a href="#versioning">Versioning</a></li>
<li><a href="#wrapping-up">Wrapping Up</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="project-structure">
	Project Structure
</h2>
<p>
	In this tutorial, we will upload our recently written project named "chorizo" to PyPi.
</p>
<p>
	There are two types of valid project structures:
</p>
<h3 id="src-layout">
	src-layout
</h3>
<p>
	The project should contain a <mark>src</mark> directory under the project root, and all modules and packages meant for distribution are placed inside this directory.
</p>
<div class="code-container">
  <pre><code>chorizo
|-- src
|   |-- chorizo
|   |   |-- __init__.py</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h3 id="flat-layout">
	flat-layout
</h3>
<p>
	The package directory is the project root itself.
</p>
<div class="code-container">
  <pre><code>chorizo
|-- chorizo
|   |-- __init__.py</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	In this project, we will use the latter, because it is simpler, cleaner, and easier to explore on GitHub. And because I just hate naming something "src", I have a cool name like "chorizo".
</p>
<h2 id="necessary-files">
	Necessary Files
</h2>
<p>
	For a project to be uploaded to PyPi, it needs to have a few files in the root directory.
</p>
<div class="code-container">
  <pre><code>chorizo
|-- chorizo
|   |-- __init__.py
|
|-- LICENSE
|-- pyproject.toml
|-- README.md
|-- requirements.txt</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h3 id="license">
	LICENSE
</h3>
<p>
	A license is a legal tool you can use to protect your intellectual property. For choosing the most suitable license for your project, check <a href="https://choosealicense.com/">https://choosealicense.com/</a> for more information.
</p>
<p>
	The most common license for open source projects is the MIT license, so we will use that one. You just need to copy the text and paste it to the <mark>LICENSE</mark> file.
</p>
<p>
	Don't forget to change the year and the name of the author.
</p>
<div class="file">LICENSE</div>
<div class="code-container">
  <pre><code>MIT License
    
Copyright (c) [year] [fullname]
    
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
    
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
    
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h3 id="readme.md">
	README.md
</h3>
<p>
	A <mark>README.md</mark> file is used to describe your project. It is a good practice to include a description of your project, the installation, some examples...
</p>
<div class="file">README.md</div>
<div class="code-container">
  <pre><code># chorizo
An example project named chorizo.
    
## Installation
```bash
pip install chorizo
```</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h3 id="pyproject.toml">
	pyproject.toml
</h3>
<p>
	The <mark>pyproject.toml</mark> file is used to configure the build process of your project. There are multiple backends available to build your project, but I am lately using <a href="https://github.com/pypa/hatch">hatchling</a>. The backend tool will be automatically installed when building, so use the one you like the most.
</p>
<p>
	It is important to update the version of your package every time you upload a new release.
</p>
<div class="file">pyproject.toml</div>
<div class="code-container">
  <pre><code>[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
    
[project]
name = "chorizo"
version = "0.0.1"
authors = [
  { name="Example Author", email="author@example.com" },
]
description = "An example project named chorizo."
readme = "README.md"
requires-python = ">=3.10"
classifiers = [
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
]
dependencies = [
    "numpy",
    "matplotlib",
    "pandas",
]
    
[project.urls]
Homepage = "https://github.com/user/chorizo"
Issues = "https://github.com/user/chorizo/issues"</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	While uploading my projects, I ran into some problems due to having a directory named "assets" in the root. It turns out, backend tools often ignore certain directories like "examples" or "tests" at the root level, but "assets" isn't typically one of them. I struggled to resolve this with <mark>setuptools</mark>, but switching to <mark>hatchling</mark> did the trick.
</p>
<p>
	If this is your case, you can add the following lines to the <mark>pyproject.toml</mark> file to specify which directories to include in the build process:
</p>
<div class="file">pyproject.toml</div>
<div class="code-container">
  <pre><code>[tool.hatch.build.targets.wheel]
packages = ["chorizo"]</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h3 id="requirements.txt">
	requirements.txt
</h3>
<p>
	It is also a good practice to leave a <mark>requirements.txt</mark> with the dependencies in case someone wants to build from source.
</p>
<div class="file">requirements.txt</div>
<div class="code-container">
  <pre><code>numpy
matplotlib
pandas</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h3 id=".gitignore">
	.gitignore
</h3>
<p>
	As a bonus tip, you can add a .gitignore file to your project to avoid uploading unnecessary files to GitHub.
</p>
<div class="file">.gitignore</div>
<div class="code-container">
  <pre><code>**/__pycache__
/dist
/build
*.egg-info</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h2 id="build-the-project">
	Build the Project
</h2>
<p>
	Now it's time to build your project and create the files that will be uploaded to PyPi.
</p>
<p>
	First of, you need to install two packages: <mark>build</mark> and <mark>twine</mark>:
</p>
<ul>
	<li><mark>build</mark> is a package that will build your project, as the name suggests.</li>
	<li><mark>twine</mark> is a package that will upload your project to PyPi super easily.</li>
</ul>
<div style="height: 20px;"></div>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>pip install build twine</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	Once everything is set up, you can build your project.
</p>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>python -m build</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	New directories will appear in your project root: <mark>dist</mark> and <mark>chorizo.egg-info</mark>. <mark>dist</mark> contains the files that will be uploaded to PyPi, and <mark>chorizo.egg-info</mark> contains some metadata about your project.
</p>
<h2 id="upload-the-project">
	Upload the Project
</h2>
<p>
	The process of uploading your project to PyPi is a bit tricky. Firstly, there are two PyPi repositories: <mark>TestPyPi</mark> and <mark>PyPi</mark>. The first one is used to test your project before uploading it to the second one. They are independent servers, so you need to create an account on both.
</p>
<div class="note">
    <div class="icon">
        <img src="../assets/important.svg"> 
        <p style="color: var(--yellow);">Important:&nbsp</p>
    </div>
    <p>Once you upload a release, it cannot be deleted, so you need to be careful.</p>
</div>
<h3 id="upload-to-testpypi">
	Upload to TestPyPi
</h3>
<p>
	It is a good idea to upload first to the test server to check if everything is working as expected. To register an account, go to <a href="https://test.pypi.org/account/register/">https://test.pypi.org/account/register/</a>.
</p>
<p>
	Now you need a token to upload your project. To get a token, go to <a href="https://test.pypi.org/manage/account/#api-tokens">https://test.pypi.org/manage/account/#api-tokens</a> and click on "Add API token". You will need to set up a Two-Factor-Autentification, which is a bit annoying, but follow the steps.
</p>
<p>
	Finally, you can upload your project to the test server.
</p>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>python -m twine upload --repository testpypi dist/*</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h3 id="download-and-test">
	Download and Test
</h3>
<p>
	You can download your project from the test server with pip. <div class="file">terminal</div>
</p>
<div class="code-container">
  <pre><code>pip install --index-url https://test.pypi.org/simple/ --no-deps chorizo</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	Ypur package will be installed with no dependendies, so you need to install them manually using your <mark>requierements.txt</mark>.
</p>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>pip install -r requirements.txt</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<h3 id="upload-to-pypi">
	Upload to PyPi
</h3>
<p>
	Once you are sure that everything is working as expected, you can upload your project to the PyPi server.
</p>
<p>
	You need now to register an account in <a href="https://pypi.org/account/register/">https://pypi.org/account/register/</a> and follow the same steps as before: enabling 2FA and generating a token.
</p>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>python -m twine upload dist/*</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	Now your project can be installed with pip. 
</p>
<h2 id="versioning">
	Versioning
</h2>
<p>
	Now it is time to upload your project to GitHub. We will tag the project with the released version and push it to GitHub. 
</p>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>git tag -a v0.0.1 -m "Release v0.0.1"
git push origin v0.0.1</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	Then, I use the GitHub CLI to upload the release files to GitHub. If you don't have it installed, you can do it with your package manager of choice.
</p>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>sudo apt install gh
sudo dnf install gh</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	You will need to log in to your GitHub account.
</p>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>gh auth login</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	And finally, you can upload the release files to GitHub. In our case, the files are in the <mark>dist</mark> directory.
</p>
<div class="file">terminal</div>
<div class="code-container">
  <pre><code>gh release create v0.0.1 dist/*</code></pre>
  <button class="copy-btn">Copy</button>
</div>
<p>
	Now you will be asked to fill out all the information about the release. I usually write a changelog.md and paste it in the description of the release. You can skip that step on the CLI and edit the release later on GitHub.
</p>
<h2 id="wrapping-up">
	Wrapping Up
</h2>
<p>
	Now you know how to upload your projects to PyPi. It is a bit tricky at first, but once you get used to it, it is pretty straightforward. I hope you find it useful!
</p>
<h2 id="references">
	References
</h2>
<ul>
	<li><a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/">Packaging Python Projects</a></li>
	<li><a href="https://setuptools.pypa.io/en/latest/userguide/package_discovery.html">Package Discovery</a></li>
</ul>
<div style="height: 120px;"></div>
    <div class="divider" style="height: 20px; background-color: var(--pink);"></div>
    <script src="./../../scripts/scroll.js"></script>
    <script src="./../../scripts/copyCode.js"></script>
    <script> hljs.highlightAll(); </script>
</body>
</html>
